<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duck Simulations</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
            background: white;
            font-family: 'Space Mono', monospace;
            overflow: hidden;
            cursor: none;
        }

        .nav-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px;
            background: #fff;
            border: 2px solid #000;
            font-family: 'Space Mono', monospace;
            font-weight: 700;
            font-size: 12px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.1s;
            text-decoration: none;
            color: #000;
            z-index: 10000;
            box-shadow: 4px 4px 0 #000;
        }

        .page-title {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Space Mono', monospace;
            font-weight: 700;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #000;
            z-index: 10000;
            background: #fff;
            padding: 10px 20px;
            border: 2px solid #000;
            box-shadow: 4px 4px 0 #000;
        }

        .nav-button:hover {
            background: #000;
            color: #fff;
        }

        .nav-button:active {
            transform: translateY(2px);
            box-shadow: 2px 2px 0 #000;
        }

        .dashboard {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 220px;
            background: #fff;
            border: 2px solid #000;
            padding: 12px;
            z-index: 10000;
            font-size: 10px;
            box-shadow: 8px 8px 0 #000;
            transition: transform 0.3s ease-in-out;
        }

        .dashboard * {
            cursor: none;
        }

        .dashboard input[type="range"],
        .dashboard select,
        .dashboard button,
        .dashboard input[type="checkbox"] {
            cursor: none;
        }

        .dashboard.collapsed {
            transform: translateX(calc(100% - 20px));
        }

        .dashboard-toggle {
            position: absolute;
            top: 50%;
            left: -20px;
            transform: translateY(-50%);
            width: 20px;
            height: 40px;
            background: #fff;
            border: 2px solid #000;
            border-right: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
        }

        .dashboard-toggle::before {
            content: "â—€";
            font-size: 12px;
            transition: transform 0.3s ease-in-out;
        }

        .dashboard.collapsed .dashboard-toggle::before {
            transform: rotate(180deg);
        }

        .dashboard-toggle:hover {
            background: #000;
            color: #fff;
        }

        .dashboard-toggle:active {
            transform: translateY(-50%) translateX(1px);
        }

        .dashboard h3 {
            margin-bottom: 8px;
            text-align: center;
            font-weight: 700;
            font-size: 11px;
            letter-spacing: 1px;
            padding-bottom: 6px;
            border-bottom: 2px solid #000;
        }

        .control-group {
            margin-bottom: 8px;
        }

        .control-group label {
            font-weight: 700;
            font-size: 9px;
            display: block;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 2px;
            background: #000;
            outline: none;
            margin: 4px 0;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background: #000;
            cursor: pointer;
            border-radius: 0;
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: #000;
            cursor: pointer;
            border-radius: 0;
        }

        .control-group select {
            width: 100%;
            padding: 3px 4px;
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            background: #fff;
            border: 1px solid #000;
            cursor: pointer;
            text-transform: uppercase;
        }

        .control-group select:focus {
            outline: 2px solid #000;
            outline-offset: 1px;
        }

        .control-group span {
            font-family: 'Space Mono', monospace;
            font-size: 8px;
            text-align: right;
            display: block;
            margin-top: -1px;
            opacity: 0.7;
        }

        .checkbox-group {
            display: flex;
            gap: 12px;
            margin-top: 4px;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .control-group input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: #fff;
            border: 2px solid #000;
            cursor: pointer;
            position: relative;
        }

        .control-group input[type="checkbox"]:checked {
            background: #000;
        }

        .checkbox-wrapper label {
            font-size: 10px;
            text-transform: uppercase;
            margin-bottom: 0;
            cursor: pointer;
        }

        .stats {
            margin: 12px 0;
            padding: 6px;
            background: #000;
            color: #fff;
        }

        .stats div {
            margin-bottom: 3px;
            font-size: 8px;
            font-weight: 400;
            display: flex;
            justify-content: space-between;
        }

        .stats span {
            font-weight: 700;
        }

        #clearAll {
            width: 100%;
            padding: 6px;
            background: #fff;
            border: 2px solid #000;
            font-family: 'Space Mono', monospace;
            font-weight: 700;
            font-size: 10px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.1s;
        }

        #clearAll:hover {
            background: #000;
            color: #fff;
        }

        #clearAll:active {
            transform: translateY(2px);
        }

        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 10001;
            transform: translate(-50%, -50%);
            mix-blend-mode: difference;
            opacity: 1;
        }

        .custom-cursor::before {
            display: none;
        }

        .custom-cursor::after {
            content: "";
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fff;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .cat-particle {
            position: fixed;
            width: 60px;
            height: 60px;
            background-image: url('duck.jpg');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            pointer-events: none;
            z-index: 1000;
        }

        /* Fallback for when duck.jpg doesn't load */
        .cat-particle::before {
            content: "ðŸ¦†";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            display: block;
        }

        .cat-particle[style*="background-image"]::before {
            display: none;
        }

        /* Hide scrollbars */
        ::-webkit-scrollbar {
            display: none;
        }

        body {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Subtle divider */
        .divider {
            height: 1px;
            background: #000;
            margin: 8px 0;
            opacity: 0.2;
        }
    </style>
</head>
<body>
    <div class="page-title">Ducks Simulator</div>
    <a href="duckMusic.html" class="nav-button">Music</a>
    <div class="dashboard">
        <h3>DUCK SYSTEM</h3>
        <button class="dashboard-toggle"></button>
        
        <div class="control-group">
            <label for="frequency">Spawn Rate</label>
            <input type="range" id="frequency" min="1" max="50" value="20">
            <span id="frequencyValue">20 Hz</span>
        </div>
        
        <div class="control-group">
            <label for="pattern">Pattern</label>
            <select id="pattern">
                <option value="radial">Radial</option>
                <option value="spiral" selected>Spiral</option>
                <option value="cone">Cone</option>
                <option value="grid">Grid</option>
                <option value="wave">Wave</option>
                <option value="fibonacci">Fibonacci</option>
                <option value="rose">Rose</option>
                <option value="lissajous">Lissajous</option>
                <option value="polar">Polar</option>
            </select>
        </div>
        
        <div class="control-group">
            <label for="velocity">Velocity</label>
            <input type="range" id="velocity" min="0.5" max="8" step="0.1" value="3">
            <span id="velocityValue">3.0</span>
        </div>
        
        <div class="control-group">
            <label for="spread">Spread</label>
            <input type="range" id="spread" min="15" max="360" value="360">
            <span id="spreadValue">360Â°</span>
        </div>
        
        <div class="control-group">
            <label for="gravity">Gravity</label>
            <input type="range" id="gravity" min="0" max="0.5" step="0.01" value="0">
            <span id="gravityValue">0.00</span>
        </div>
        
        <div class="control-group">
            <label for="lifetime">Lifetime</label>
            <input type="range" id="lifetime" min="500" max="5000" step="100" value="2000">
            <span id="lifetimeValue">2000 ms</span>
        </div>

        <div class="control-group">
            <label for="sizeVariation">Size Variation</label>
            <input type="range" id="sizeVariation" min="0" max="100" value="50">
            <span id="sizeVariationValue">50%</span>
        </div>

        <div class="control-group">
            <label for="colorCycle">Color Cycle</label>
            <input type="range" id="colorCycle" min="0" max="5" step="0.1" value="1">
            <span id="colorCycleValue">1.0</span>
        </div>

        <div class="control-group">
            <label for="attractionMode">Force Mode</label>
            <select id="attractionMode">
                <option value="none">None</option>
                <option value="center">Center</option>
                <option value="mouse">Attract</option>
                <option value="repulsion">Repel</option>
                <option value="orbit">Orbit</option>
            </select>
        </div>

        <div class="control-group">
            <label for="forceStrength">Force Strength</label>
            <input type="range" id="forceStrength" min="0" max="2" step="0.1" value="0.5">
            <span id="forceStrengthValue">0.5</span>
        </div>

        <div class="divider"></div>

        <div class="control-group">
            <div class="checkbox-group">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="trails">
                    <label for="trails">Trails</label>
                </div>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="bounceMode">
                    <label for="bounceMode">Bounce</label>
                </div>
            </div>
        </div>
        
        <div class="stats">
            <div>Active <span id="particleCount">0</span></div>
            <div>Total <span id="totalSpawned">0</span></div>
            <div>Velocity <span id="avgVelocity">0.0</span></div>
        </div>
        
        <button id="clearAll">Clear</button>
    </div>

    <div class="custom-cursor"></div>
    
    <script>
        class ParticleSystem {
            constructor() {
                this.mouseX = 0;
                this.mouseY = 0;
                this.particles = [];
                this.lastSpawnTime = 0;
                this.totalSpawned = 0;
                this.time = 0;
                
                this.params = {
                    frequency: 20,      // Hz
                    pattern: 'spiral',
                    velocity: 3.0,
                    spread: 360,        // degrees
                    gravity: 0,
                    lifetime: 2000,     // ms
                    sizeVariation: 50,  // %
                    colorCycle: 1.0,
                    attractionMode: 'none',
                    forceStrength: 0.5,
                    trails: false,
                    bounceMode: false
                };
                
                this.cursor = document.querySelector('.custom-cursor');
                this.dashboard = document.querySelector('.dashboard');
                this.dashboardToggle = document.querySelector('.dashboard-toggle');
                this.initControls();
                this.bindEvents();
                this.animate();
            }
            
            initControls() {
                // Add dashboard toggle functionality
                this.dashboardToggle.addEventListener('click', () => {
                    this.dashboard.classList.toggle('collapsed');
                });

                const controls = {
                    frequency: { element: 'frequency', display: 'frequencyValue', suffix: ' Hz' },
                    velocity: { element: 'velocity', display: 'velocityValue', suffix: '' },
                    spread: { element: 'spread', display: 'spreadValue', suffix: 'Â°' },
                    gravity: { element: 'gravity', display: 'gravityValue', suffix: '' },
                    lifetime: { element: 'lifetime', display: 'lifetimeValue', suffix: ' ms' },
                    sizeVariation: { element: 'sizeVariation', display: 'sizeVariationValue', suffix: '%' },
                    colorCycle: { element: 'colorCycle', display: 'colorCycleValue', suffix: '' },
                    forceStrength: { element: 'forceStrength', display: 'forceStrengthValue', suffix: '' }
                };
                
                Object.entries(controls).forEach(([param, config]) => {
                    const input = document.getElementById(config.element);
                    const display = document.getElementById(config.display);
                    
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        this.params[param] = value;
                        
                        if (param === 'gravity' || param === 'colorCycle' || param === 'forceStrength') {
                            display.textContent = value.toFixed(2) + config.suffix;
                        } else if (param === 'velocity') {
                            display.textContent = value.toFixed(1) + config.suffix;
                        } else {
                            display.textContent = value.toString() + config.suffix;
                        }
                    });
                });
                
                document.getElementById('pattern').addEventListener('change', (e) => {
                    this.params.pattern = e.target.value;
                });
                
                document.addEventListener('mousemove', (e) => {
                    this.mouseX = e.clientX;
                    this.mouseY = e.clientY;
                    this.cursor.style.left = this.mouseX + 'px';
                    this.cursor.style.top = this.mouseY + 'px';
                });
                
                document.addEventListener('mouseleave', () => {
                    this.cursor.style.opacity = '0';
                });
                
                document.addEventListener('mouseenter', () => {
                    this.cursor.style.opacity = '1';
                });
                
                document.getElementById('attractionMode').addEventListener('change', (e) => {
                    this.params.attractionMode = e.target.value;
                });
                
                document.getElementById('trails').addEventListener('change', (e) => {
                    this.params.trails = e.target.checked;
                });
                
                document.getElementById('bounceMode').addEventListener('change', (e) => {
                    this.params.bounceMode = e.target.checked;
                });
                
                document.getElementById('clearAll').addEventListener('click', () => {
                    this.clearAllParticles();
                });
            }
            
            bindEvents() {
                document.addEventListener('mousemove', (e) => {
                    this.mouseX = e.clientX;
                    this.mouseY = e.clientY;
                    this.cursor.style.left = this.mouseX + 'px';
                    this.cursor.style.top = this.mouseY + 'px';
                });
                
                document.addEventListener('mouseleave', () => {
                    this.cursor.style.opacity = '0';
                });
                
                document.addEventListener('mouseenter', () => {
                    this.cursor.style.opacity = '1';
                });

                // Show cursor when over dashboard
                this.dashboard.addEventListener('mouseenter', () => {
                    this.cursor.style.opacity = '1';
                });
            }
            
            shouldSpawn() {
                const now = performance.now();
                const interval = 1000 / this.params.frequency;
                
                if (now - this.lastSpawnTime >= interval) {
                    this.lastSpawnTime = now;
                    return true;
                }
                return false;
            }
            
            calculateEmissionVector(index, total) {
                const patterns = {
                    radial: () => {
                        const angle = (Math.PI * 2 * index) / total;
                        return { angle, speed: this.params.velocity };
                    },
                    
                    spiral: () => {
                        const spiralRate = 0.5;
                        const angle = (this.time * spiralRate) + (index * 0.3);
                        return { angle, speed: this.params.velocity };
                    },
                    
                    cone: () => {
                        const spreadRad = (this.params.spread * Math.PI) / 180;
                        const baseAngle = -Math.PI / 2; // Point upward
                        const angle = baseAngle + (Math.random() - 0.5) * spreadRad;
                        return { angle, speed: this.params.velocity };
                    },
                    
                    grid: () => {
                        const gridSize = 3;
                        const row = Math.floor(index / gridSize);
                        const col = index % gridSize;
                        const angle = Math.atan2(row - 1, col - 1);
                        return { angle, speed: this.params.velocity };
                    },
                    
                    wave: () => {
                        const waveFreq = 0.02;
                        const angle = Math.sin(this.time * waveFreq + index) * Math.PI;
                        return { angle, speed: this.params.velocity };
                    },
                    
                    fibonacci: () => {
                        const goldenAngle = Math.PI * (3 - Math.sqrt(5)); // Golden angle in radians
                        const angle = index * goldenAngle;
                        const radius = Math.sqrt(index) * 0.5;
                        return { angle, speed: this.params.velocity * (1 + radius * 0.1) };
                    },
                    
                    rose: () => {
                        const k = 5; // Number of petals
                        const angle = this.time * 0.1 + index * 0.2;
                        const r = Math.cos(k * angle);
                        return { angle: angle + r, speed: this.params.velocity };
                    },
                    
                    lissajous: () => {
                        const a = 3, b = 2; // Frequency ratios
                        const t = this.time * 0.01 + index * 0.1;
                        const x = Math.sin(a * t);
                        const y = Math.cos(b * t);
                        const angle = Math.atan2(y, x);
                        return { angle, speed: this.params.velocity };
                    },
                    
                    polar: () => {
                        const t = this.time * 0.05 + index * 0.15;
                        const r = Math.sin(3 * t) * Math.cos(2 * t);
                        const angle = t + r;
                        return { angle, speed: this.params.velocity * (1 + Math.abs(r)) };
                    }
                };
                
                return patterns[this.params.pattern]();
            }
            
            spawnParticle() {
                const particle = document.createElement('div');
                particle.className = 'cat-particle';
                particle.style.left = this.mouseX + 'px';
                particle.style.top = this.mouseY + 'px';
                
                // Size variation
                const sizeVar = this.params.sizeVariation / 100;
                const baseSize = 60;
                const size = baseSize * (1 + (Math.random() - 0.5) * sizeVar);
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // Color cycling
                if (this.params.colorCycle > 0) {
                    const hue = (this.time * this.params.colorCycle * 50) % 360;
                    particle.style.filter = `hue-rotate(${hue}deg) saturate(1.2)`;
                }
                
                // Trail mode
                if (this.params.trails) {
                    particle.classList.add('trail-mode');
                }
                
                document.body.appendChild(particle);
                
                const emission = this.calculateEmissionVector(this.totalSpawned, 8);
                const particleData = {
                    element: particle,
                    vx: Math.cos(emission.angle) * emission.speed,
                    vy: Math.sin(emission.angle) * emission.speed,
                    life: this.params.lifetime,
                    startTime: performance.now(),
                    rotation: Math.random() * 360,
                    size: size
                };
                
                this.particles.push(particleData);
                this.totalSpawned++;
            }
            
            updateParticles() {
                const now = performance.now();
                let totalVelocity = 0;
                
                this.particles = this.particles.filter(particle => {
                    const age = now - particle.startTime;
                    const progress = age / particle.life;
                    
                    if (progress >= 1) {
                        if (particle.element.parentNode) {
                            particle.element.parentNode.removeChild(particle.element);
                        }
                        return false;
                    }
                    
                    // Current position
                    const currentX = parseFloat(particle.element.style.left);
                    const currentY = parseFloat(particle.element.style.top);
                    
                    // Apply attraction forces
                    this.applyForces(particle, currentX, currentY);
                    
                    // Update position
                    const newX = currentX + particle.vx;
                    const newY = currentY + particle.vy;
                    
                    // Bounce detection
                    if (this.params.bounceMode) {
                        const size = particle.size || 60;
                        if (newX <= size/2 || newX >= window.innerWidth - size/2) {
                            particle.vx *= -0.8; // Energy loss on bounce
                        }
                        if (newY <= size/2 || newY >= window.innerHeight - size/2) {
                            particle.vy *= -0.8;
                        }
                    }
                    
                    particle.element.style.left = Math.max(0, Math.min(window.innerWidth, newX)) + 'px';
                    particle.element.style.top = Math.max(0, Math.min(window.innerHeight, newY)) + 'px';
                    
                    // Apply gravity
                    particle.vy += this.params.gravity;
                    
                    // Apply air resistance
                    particle.vx *= 0.999;
                    particle.vy *= 0.999;
                    
                    // Calculate velocity for stats
                    const velocity = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);
                    totalVelocity += velocity;
                    
                    // Update visual properties
                    const opacity = 1 - (progress * 0.8);
                    const scale = 1 - (progress * 0.3);
                    const rotation = particle.rotation + (age * 0.1);
                    
                    particle.element.style.opacity = opacity;
                    particle.element.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
                    
                    return true;
                });
                
                this.avgVelocity = this.particles.length > 0 ? totalVelocity / this.particles.length : 0;
            }
            
            applyForces(particle, x, y) {
                const force = this.params.forceStrength * 0.01;
                
                switch (this.params.attractionMode) {
                    case 'center':
                        const centerX = window.innerWidth / 2;
                        const centerY = window.innerHeight / 2;
                        const toCenterX = centerX - x;
                        const toCenterY = centerY - y;
                        const centerDist = Math.sqrt(toCenterX * toCenterX + toCenterY * toCenterY);
                        if (centerDist > 0) {
                            particle.vx += (toCenterX / centerDist) * force;
                            particle.vy += (toCenterY / centerDist) * force;
                        }
                        break;
                        
                    case 'mouse':
                        const toMouseX = this.mouseX - x;
                        const toMouseY = this.mouseY - y;
                        const mouseDist = Math.sqrt(toMouseX * toMouseX + toMouseY * toMouseY);
                        if (mouseDist > 0 && mouseDist < 200) {
                            const forceScale = (200 - mouseDist) / 200;
                            particle.vx += (toMouseX / mouseDist) * force * forceScale;
                            particle.vy += (toMouseY / mouseDist) * force * forceScale;
                        }
                        break;
                        
                    case 'repulsion':
                        const fromMouseX = x - this.mouseX;
                        const fromMouseY = y - this.mouseY;
                        const repulseDist = Math.sqrt(fromMouseX * fromMouseX + fromMouseY * fromMouseY);
                        if (repulseDist > 0 && repulseDist < 150) {
                            const forceScale = (150 - repulseDist) / 150;
                            particle.vx += (fromMouseX / repulseDist) * force * forceScale * 2;
                            particle.vy += (fromMouseY / repulseDist) * force * forceScale * 2;
                        }
                        break;
                        
                    case 'orbit':
                        const orbitalX = this.mouseX - x;
                        const orbitalY = this.mouseY - y;
                        const orbitalDist = Math.sqrt(orbitalX * orbitalX + orbitalY * orbitalY);
                        if (orbitalDist > 0) {
                            // Tangential force for orbital motion
                            particle.vx += (-orbitalY / orbitalDist) * force;
                            particle.vy += (orbitalX / orbitalDist) * force;
                            // Small centripetal force
                            particle.vx += (orbitalX / orbitalDist) * force * 0.1;
                            particle.vy += (orbitalY / orbitalDist) * force * 0.1;
                        }
                        break;
                }
            }
            
            updateStats() {
                document.getElementById('particleCount').textContent = this.particles.length;
                document.getElementById('totalSpawned').textContent = this.totalSpawned;
                document.getElementById('avgVelocity').textContent = this.avgVelocity.toFixed(1);
            }
            
            clearAllParticles() {
                this.particles.forEach(particle => {
                    if (particle.element.parentNode) {
                        particle.element.parentNode.removeChild(particle.element);
                    }
                });
                this.particles = [];
                this.totalSpawned = 0;
            }
            
            animate() {
                this.time = performance.now() * 0.001; // Convert to seconds
                
                if (this.shouldSpawn()) {
                    this.spawnParticle();
                }
                
                this.updateParticles();
                this.updateStats();
                
                requestAnimationFrame(() => this.animate());
            }
        }

        // Initialize the particle system when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new ParticleSystem();
        });

        // Mathematical utility functions
        const MathUtils = {
            lerp: (a, b, t) => a + (b - a) * t,
            
            clamp: (value, min, max) => Math.min(Math.max(value, min), max),
            
            map: (value, inMin, inMax, outMin, outMax) => {
                return (value - inMin) * (outMax - outMin) / (inMax - inMin) + outMin;
            },
            
            degToRad: (degrees) => degrees * Math.PI / 180,
            
            radToDeg: (radians) => radians * 180 / Math.PI,
            
            distance: (x1, y1, x2, y2) => {
                return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            }
        };
    </script>
</body>
</html>